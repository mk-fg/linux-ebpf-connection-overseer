Linux eBPF Connection Overseer
==============================

Network monitoring tool intended to export or display info about both
functioning and blocked network connections, with associated process/cgroup
information, as well as traffic counters on those.

It's a work in progress, not supposed to be functional just yet.

Repository URLs:

- <https://github.com/mk-fg/linux-ebpf-connection-overseer>
- <https://codeberg.org/mk-fg/linux-ebpf-connection-overseer>
- <https://fraggod.net/code/git/linux-ebpf-connection-overseer>


# Technical details

Intended to consists of two components:

- Self-contained [eBPF] binary (mostly generated by `bpftool gen skeleton`),
  that only loads eBPF blob into kernel and stores file descriptors of all
  data maps in systemd service [File Descriptor Store], or exits if it's done already.

    Requires elevated privileges, intended to be run as `ExecStartPre=+...` command.

- Unprivileged python script that uses eBPF map file descriptors to monitor for
  required data and export it somewhere in a nice way (e.g. warnings or UI overlay).

It's kinda similar to [OpenSnitch project] and is based on eBPF code from there,
but with much simpler non-interactive read-only scope, and no extra access beyond
reading data from those eBPF file descriptors.

[eBPF]: https://docs.ebpf.io/
[File Descriptor Store]: https://systemd.io/FILE_DESCRIPTOR_STORE/
[OpenSnitch project]: https://github.com/evilsocket/opensnitch


# Requirements

Build requires: make, clang, llvm, and kernel headers (e.g. kernel-devel package).

Running resulting eBPF-binary on a system needs linux 6.x+, with following config opts enabled:
``` console
% bsdcat /proc/config.* | grep -E 'BPF|KPROBE'
## Alternatively: grep -E 'BPF|KPROBE' /boot/config-$(uname -r)
CONFIG_BPF=y
CONFIG_BPF_SYSCALL=y
CONFIG_BPF_EVENTS=y
CONFIG_KPROBES=y
CONFIG_KPROBE_EVENTS=y
```

Run `git submodule init && git submodule update` first to fetch libbpf/bpftool dependencies.\
After that, `make` should produce `leco-ebpf-load` eBPF loader binary.\
There's no userspace script and .service file to use it with yet.
